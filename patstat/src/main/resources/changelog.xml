<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

    <changeSet id="1" author="jpc">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="dept"/>
            </not>
        </preConditions>

        <!-- dept -->
        <createTable tableName="dept">
            <column name="depno" type="bigint">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="dname" type="varchar(64)">
                <constraints nullable="false" uniqueConstraintName="uk_dept_dname" unique="true"/>
            </column>
            <column name="loc" type="varchar(64)">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <!-- emp -->
        <createTable tableName="emp">
            <column name="empno" type="bigint">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="ename" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="job" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="mgr" type="bigint">
                <constraints nullable="true"/>
            </column>
            <column name="hiredate" type="date">
                <constraints nullable="false"/>
            </column>
            <column name="sal" type="decimal(7,2)">
                <constraints nullable="false"/>
            </column>
            <column name="comm" type="decimal(7,2)">
                <constraints nullable="true"/>
            </column>
            <column name="depno" type="bigint">
                <constraints nullable="false" foreignKeyName="fk_emp_depno" referencedTableName="dept" referencedColumnNames="depno"/>
            </column>
        </createTable>
        <addForeignKeyConstraint constraintName="fk_emp_mgr" baseTableName="emp" baseColumnNames="mgr" referencedTableName="emp" referencedColumnNames="empno"/>

    </changeSet>

    <changeSet id="2" author="jpc">
        <preConditions onFail="MARK_RAN">
            <tableIsEmpty tableName="dept"/>
        </preConditions>
        <insert tableName="dept">
            <column name="depno">10</column>
            <column name="dname">ACCOUNTING</column>
            <column name="loc">NEW YORK</column>
        </insert>
        <insert tableName="emp">
            <column name="empno">7839</column>
            <column name="ename">KING</column>
            <column name="job">PRESIDENT</column>
            <column name="mgr"></column>
            <column name="hiredate">1981-11-17</column>
            <column name="sal">5000.00</column>
            <column name="comm"></column>
            <column name="depno">10</column>
        </insert>
        <insert tableName="emp">
            <column name="empno">7782</column>
            <column name="ename">CLARK</column>
            <column name="job">MANAGER</column>
            <column name="mgr">7839</column>
            <column name="hiredate">1981-06-09</column>
            <column name="sal">2450.00</column>
            <column name="comm"></column>
            <column name="depno">10</column>
        </insert>
    </changeSet>

</databaseChangeLog>